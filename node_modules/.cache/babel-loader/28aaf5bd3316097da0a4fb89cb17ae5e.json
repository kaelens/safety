{"ast":null,"code":"const tar = require('tar');\n\nconst ssri = require('ssri');\n\nconst npmlog = require('npmlog');\n\nconst byteSize = require('byte-size');\n\nconst columnify = require('columnify');\n\nconst logTar = (tarball, opts = {}) => {\n  const {\n    unicode = false,\n    log = npmlog\n  } = opts;\n  log.notice('');\n  log.notice('', `${unicode ? 'ðŸ“¦ ' : 'package:'} ${tarball.name}@${tarball.version}`);\n  log.notice('=== Tarball Contents ===');\n\n  if (tarball.files.length) {\n    log.notice('', columnify(tarball.files.map(f => {\n      const bytes = byteSize(f.size);\n      return /^node_modules\\//.test(f.path) ? null : {\n        path: f.path,\n        size: `${bytes.value}${bytes.unit}`\n      };\n    }).filter(f => f), {\n      include: ['size', 'path'],\n      showHeaders: false\n    }));\n  }\n\n  if (tarball.bundled.length) {\n    log.notice('=== Bundled Dependencies ===');\n    tarball.bundled.forEach(name => log.notice('', name));\n  }\n\n  log.notice('=== Tarball Details ===');\n  log.notice('', columnify([{\n    name: 'name:',\n    value: tarball.name\n  }, {\n    name: 'version:',\n    value: tarball.version\n  }, tarball.filename && {\n    name: 'filename:',\n    value: tarball.filename\n  }, {\n    name: 'package size:',\n    value: byteSize(tarball.size)\n  }, {\n    name: 'unpacked size:',\n    value: byteSize(tarball.unpackedSize)\n  }, {\n    name: 'shasum:',\n    value: tarball.shasum\n  }, {\n    name: 'integrity:',\n    value: tarball.integrity.toString().substr(0, 20) + '[...]' + tarball.integrity.toString().substr(80)\n  }, tarball.bundled.length && {\n    name: 'bundled deps:',\n    value: tarball.bundled.length\n  }, tarball.bundled.length && {\n    name: 'bundled files:',\n    value: tarball.entryCount - tarball.files.length\n  }, tarball.bundled.length && {\n    name: 'own files:',\n    value: tarball.files.length\n  }, {\n    name: 'total files:',\n    value: tarball.entryCount\n  }].filter(x => x), {\n    include: ['name', 'value'],\n    showHeaders: false\n  }));\n  log.notice('', '');\n};\n\nconst getContents = async (manifest, tarball) => {\n  const files = [];\n  const bundled = new Set();\n  let totalEntries = 0;\n  let totalEntrySize = 0; // reads contents of tarball\n\n  const stream = tar.t({\n    onentry(entry) {\n      totalEntries++;\n      totalEntrySize += entry.size;\n      const p = entry.path;\n\n      if (p.startsWith('package/node_modules/')) {\n        const name = p.match(/^package\\/node_modules\\/((?:@[^/]+\\/)?[^/]+)/)[1];\n        bundled.add(name);\n      }\n\n      files.push({\n        path: entry.path.replace(/^package\\//, ''),\n        size: entry.size,\n        mode: entry.mode\n      });\n    }\n\n  });\n  stream.end(tarball);\n  const integrity = await ssri.fromData(tarball, {\n    algorithms: ['sha1', 'sha512']\n  });\n\n  const comparator = (a, b) => {\n    return a.path.localeCompare(b.path, undefined, {\n      sensitivity: 'case',\n      numeric: true\n    });\n  };\n\n  const isUpper = str => {\n    const ch = str.charAt(0);\n    return ch >= 'A' && ch <= 'Z';\n  };\n\n  const uppers = files.filter(file => isUpper(file.path));\n  const others = files.filter(file => !isUpper(file.path));\n  uppers.sort(comparator);\n  others.sort(comparator);\n  const shasum = integrity.sha1[0].hexDigest();\n  return {\n    id: manifest._id || `${manifest.name}@${manifest.version}`,\n    name: manifest.name,\n    version: manifest.version,\n    size: tarball.length,\n    unpackedSize: totalEntrySize,\n    shasum,\n    integrity: ssri.parse(integrity.sha512[0]),\n    filename: `${manifest.name}-${manifest.version}.tgz`,\n    files: uppers.concat(others),\n    entryCount: totalEntries,\n    bundled: Array.from(bundled)\n  };\n};\n\nmodule.exports = {\n  logTar,\n  getContents\n};","map":{"version":3,"sources":["/Users/kaelen/nsc-mds/node_modules/npm/lib/utils/tar.js"],"names":["tar","require","ssri","npmlog","byteSize","columnify","logTar","tarball","opts","unicode","log","notice","name","version","files","length","map","f","bytes","size","test","path","value","unit","filter","include","showHeaders","bundled","forEach","filename","unpackedSize","shasum","integrity","toString","substr","entryCount","x","getContents","manifest","Set","totalEntries","totalEntrySize","stream","t","onentry","entry","p","startsWith","match","add","push","replace","mode","end","fromData","algorithms","comparator","a","b","localeCompare","undefined","sensitivity","numeric","isUpper","str","ch","charAt","uppers","file","others","sort","sha1","hexDigest","id","_id","parse","sha512","concat","Array","from","module","exports"],"mappings":"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","sourcesContent":["const tar = require('tar')\nconst ssri = require('ssri')\nconst npmlog = require('npmlog')\nconst byteSize = require('byte-size')\nconst columnify = require('columnify')\n\nconst logTar = (tarball, opts = {}) => {\n  const { unicode = false, log = npmlog } = opts\n  log.notice('')\n  log.notice('', `${unicode ? 'ðŸ“¦ ' : 'package:'} ${tarball.name}@${tarball.version}`)\n  log.notice('=== Tarball Contents ===')\n  if (tarball.files.length) {\n    log.notice('', columnify(tarball.files.map((f) => {\n      const bytes = byteSize(f.size)\n      return (/^node_modules\\//.test(f.path)) ? null\n        : { path: f.path, size: `${bytes.value}${bytes.unit}` }\n    }).filter(f => f), {\n      include: ['size', 'path'],\n      showHeaders: false,\n    }))\n  }\n  if (tarball.bundled.length) {\n    log.notice('=== Bundled Dependencies ===')\n    tarball.bundled.forEach((name) => log.notice('', name))\n  }\n  log.notice('=== Tarball Details ===')\n  log.notice('', columnify([\n    { name: 'name:', value: tarball.name },\n    { name: 'version:', value: tarball.version },\n    tarball.filename && { name: 'filename:', value: tarball.filename },\n    { name: 'package size:', value: byteSize(tarball.size) },\n    { name: 'unpacked size:', value: byteSize(tarball.unpackedSize) },\n    { name: 'shasum:', value: tarball.shasum },\n    {\n      name: 'integrity:',\n      value: tarball.integrity.toString().substr(0, 20) + '[...]' + tarball.integrity.toString().substr(80),\n    },\n    tarball.bundled.length && { name: 'bundled deps:', value: tarball.bundled.length },\n    tarball.bundled.length && { name: 'bundled files:', value: tarball.entryCount - tarball.files.length },\n    tarball.bundled.length && { name: 'own files:', value: tarball.files.length },\n    { name: 'total files:', value: tarball.entryCount },\n  ].filter((x) => x), {\n    include: ['name', 'value'],\n    showHeaders: false,\n  }))\n  log.notice('', '')\n}\n\nconst getContents = async (manifest, tarball) => {\n  const files = []\n  const bundled = new Set()\n  let totalEntries = 0\n  let totalEntrySize = 0\n\n  // reads contents of tarball\n  const stream = tar.t({\n    onentry (entry) {\n      totalEntries++\n      totalEntrySize += entry.size\n      const p = entry.path\n      if (p.startsWith('package/node_modules/')) {\n        const name = p.match(/^package\\/node_modules\\/((?:@[^/]+\\/)?[^/]+)/)[1]\n        bundled.add(name)\n      }\n      files.push({\n        path: entry.path.replace(/^package\\//, ''),\n        size: entry.size,\n        mode: entry.mode,\n      })\n    },\n  })\n  stream.end(tarball)\n\n  const integrity = await ssri.fromData(tarball, {\n    algorithms: ['sha1', 'sha512'],\n  })\n\n  const comparator = (a, b) => {\n    return a.path.localeCompare(b.path, undefined, {\n      sensitivity: 'case',\n      numeric: true,\n    })\n  }\n\n  const isUpper = (str) => {\n    const ch = str.charAt(0)\n    return ch >= 'A' && ch <= 'Z'\n  }\n\n  const uppers = files.filter(file => isUpper(file.path))\n  const others = files.filter(file => !isUpper(file.path))\n\n  uppers.sort(comparator)\n  others.sort(comparator)\n\n  const shasum = integrity.sha1[0].hexDigest()\n  return {\n    id: manifest._id || `${manifest.name}@${manifest.version}`,\n    name: manifest.name,\n    version: manifest.version,\n    size: tarball.length,\n    unpackedSize: totalEntrySize,\n    shasum,\n    integrity: ssri.parse(integrity.sha512[0]),\n    filename: `${manifest.name}-${manifest.version}.tgz`,\n    files: uppers.concat(others),\n    entryCount: totalEntries,\n    bundled: Array.from(bundled),\n  }\n}\n\nmodule.exports = { logTar, getContents }\n"]},"metadata":{},"sourceType":"script"}