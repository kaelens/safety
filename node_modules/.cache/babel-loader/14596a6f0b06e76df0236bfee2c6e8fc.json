{"ast":null,"code":"var fs = require('fs');\n\nvar path = require('path');\n\nvar glob = require('glob');\n\nvar normalizeData = require('normalize-package-data');\n\nvar safeJSON = require('json-parse-even-better-errors');\n\nvar util = require('util');\n\nvar normalizePackageBin = require('npm-normalize-package-bin');\n\nmodule.exports = readJson; // put more stuff on here to customize.\n\nreadJson.extraSet = [bundleDependencies, gypfile, serverjs, scriptpath, authors, readme, mans, bins, githead];\nvar typoWarned = {};\nvar cache = {};\n\nfunction readJson(file, log_, strict_, cb_) {\n  var log, strict, cb;\n\n  for (var i = 1; i < arguments.length - 1; i++) {\n    if (typeof arguments[i] === 'boolean') {\n      strict = arguments[i];\n    } else if (typeof arguments[i] === 'function') {\n      log = arguments[i];\n    }\n  }\n\n  if (!log) log = function () {};\n  cb = arguments[arguments.length - 1];\n  readJson_(file, log, strict, cb);\n}\n\nfunction readJson_(file, log, strict, cb) {\n  fs.readFile(file, 'utf8', function (er, d) {\n    parseJson(file, er, d, log, strict, cb);\n  });\n}\n\nfunction stripBOM(content) {\n  // Remove byte order marker. This catches EF BB BF (the UTF-8 BOM)\n  // because the buffer-to-string conversion in `fs.readFileSync()`\n  // translates it to FEFF, the UTF-16 BOM.\n  if (content.charCodeAt(0) === 0xFEFF) content = content.slice(1);\n  return content;\n}\n\nfunction jsonClone(obj) {\n  if (obj == null) {\n    return obj;\n  } else if (Array.isArray(obj)) {\n    var newarr = new Array(obj.length);\n\n    for (var ii in obj) {\n      newarr[ii] = obj[ii];\n    }\n  } else if (typeof obj === 'object') {\n    var newobj = {};\n\n    for (var kk in obj) {\n      newobj[kk] = jsonClone[kk];\n    }\n  } else {\n    return obj;\n  }\n}\n\nfunction parseJson(file, er, d, log, strict, cb) {\n  if (er && er.code === 'ENOENT') {\n    return fs.stat(path.dirname(file), function (err, stat) {\n      if (!err && stat && !stat.isDirectory()) {\n        // ENOTDIR isn't used on Windows, but npm expects it.\n        er = Object.create(er);\n        er.code = 'ENOTDIR';\n        return cb(er);\n      } else {\n        return indexjs(file, er, log, strict, cb);\n      }\n    });\n  }\n\n  if (er) return cb(er);\n  if (cache[d]) return cb(null, jsonClone(cache[d]));\n  var data;\n\n  try {\n    data = safeJSON(stripBOM(d));\n\n    for (var key in data) {\n      if (/^_/.test(key)) {\n        delete data[key];\n      }\n    }\n  } catch (er) {\n    data = parseIndex(d);\n    if (!data) return cb(parseError(er, file));\n  }\n\n  extrasCached(file, d, data, log, strict, cb);\n}\n\nfunction extrasCached(file, d, data, log, strict, cb) {\n  extras(file, data, log, strict, function (err, data) {\n    if (!err) {\n      cache[d] = jsonClone(data);\n    }\n\n    cb(err, data);\n  });\n}\n\nfunction indexjs(file, er, log, strict, cb) {\n  if (path.basename(file) === 'index.js') return cb(er);\n  var index = path.resolve(path.dirname(file), 'index.js');\n  fs.readFile(index, 'utf8', function (er2, d) {\n    if (er2) return cb(er);\n    if (cache[d]) return cb(null, cache[d]);\n    var data = parseIndex(d);\n    if (!data) return cb(er);\n    extrasCached(file, d, data, log, strict, cb);\n  });\n}\n\nreadJson.extras = extras;\n\nfunction extras(file, data, log_, strict_, cb_) {\n  var log, strict, cb;\n\n  for (var i = 2; i < arguments.length - 1; i++) {\n    if (typeof arguments[i] === 'boolean') {\n      strict = arguments[i];\n    } else if (typeof arguments[i] === 'function') {\n      log = arguments[i];\n    }\n  }\n\n  if (!log) log = function () {};\n  cb = arguments[i];\n  var set = readJson.extraSet;\n  var n = set.length;\n  var errState = null;\n  set.forEach(function (fn) {\n    fn(file, data, then);\n  });\n\n  function then(er) {\n    if (errState) return;\n    if (er) return cb(errState = er);\n    if (--n > 0) return;\n    final(file, data, log, strict, cb);\n  }\n}\n\nfunction scriptpath(file, data, cb) {\n  if (!data.scripts) return cb(null, data);\n  var k = Object.keys(data.scripts);\n  k.forEach(scriptpath_, data.scripts);\n  cb(null, data);\n}\n\nfunction scriptpath_(key) {\n  var s = this[key]; // This is never allowed, and only causes problems\n\n  if (typeof s !== 'string') return delete this[key];\n  var spre = /^(\\.[/\\\\])?node_modules[/\\\\].bin[\\\\/]/;\n\n  if (s.match(spre)) {\n    this[key] = this[key].replace(spre, '');\n  }\n}\n\nfunction gypfile(file, data, cb) {\n  var dir = path.dirname(file);\n  var s = data.scripts || {};\n  if (s.install || s.preinstall) return cb(null, data);\n  glob('*.gyp', {\n    cwd: dir\n  }, function (er, files) {\n    if (er) return cb(er);\n    if (data.gypfile === false) return cb(null, data);\n    gypfile_(file, data, files, cb);\n  });\n}\n\nfunction gypfile_(file, data, files, cb) {\n  if (!files.length) return cb(null, data);\n  var s = data.scripts || {};\n  s.install = 'node-gyp rebuild';\n  data.scripts = s;\n  data.gypfile = true;\n  return cb(null, data);\n}\n\nfunction serverjs(file, data, cb) {\n  var dir = path.dirname(file);\n  var s = data.scripts || {};\n  if (s.start) return cb(null, data);\n  glob('server.js', {\n    cwd: dir\n  }, function (er, files) {\n    if (er) return cb(er);\n    serverjs_(file, data, files, cb);\n  });\n}\n\nfunction serverjs_(file, data, files, cb) {\n  if (!files.length) return cb(null, data);\n  var s = data.scripts || {};\n  s.start = 'node server.js';\n  data.scripts = s;\n  return cb(null, data);\n}\n\nfunction authors(file, data, cb) {\n  if (data.contributors) return cb(null, data);\n  var af = path.resolve(path.dirname(file), 'AUTHORS');\n  fs.readFile(af, 'utf8', function (er, ad) {\n    // ignore error.  just checking it.\n    if (er) return cb(null, data);\n    authors_(file, data, ad, cb);\n  });\n}\n\nfunction authors_(file, data, ad, cb) {\n  ad = ad.split(/\\r?\\n/g).map(function (line) {\n    return line.replace(/^\\s*#.*$/, '').trim();\n  }).filter(function (line) {\n    return line;\n  });\n  data.contributors = ad;\n  return cb(null, data);\n}\n\nfunction readme(file, data, cb) {\n  if (data.readme) return cb(null, data);\n  var dir = path.dirname(file);\n  var globOpts = {\n    cwd: dir,\n    nocase: true,\n    mark: true\n  };\n  glob('{README,README.*}', globOpts, function (er, files) {\n    if (er) return cb(er); // don't accept directories.\n\n    files = files.filter(function (file) {\n      return !file.match(/\\/$/);\n    });\n    if (!files.length) return cb();\n    var fn = preferMarkdownReadme(files);\n    var rm = path.resolve(dir, fn);\n    readme_(file, data, rm, cb);\n  });\n}\n\nfunction preferMarkdownReadme(files) {\n  var fallback = 0;\n  var re = /\\.m?a?r?k?d?o?w?n?$/i;\n\n  for (var i = 0; i < files.length; i++) {\n    if (files[i].match(re)) {\n      return files[i];\n    } else if (files[i].match(/README$/)) {\n      fallback = i;\n    }\n  } // prefer README.md, followed by README; otherwise, return\n  // the first filename (which could be README)\n\n\n  return files[fallback];\n}\n\nfunction readme_(file, data, rm, cb) {\n  var rmfn = path.basename(rm);\n  fs.readFile(rm, 'utf8', function (er, rm) {\n    // maybe not readable, or something.\n    if (er) return cb();\n    data.readme = rm;\n    data.readmeFilename = rmfn;\n    return cb(er, data);\n  });\n}\n\nfunction mans(file, data, cb) {\n  var m = data.directories && data.directories.man;\n  if (data.man || !m) return cb(null, data);\n  m = path.resolve(path.dirname(file), m);\n  glob('**/*.[0-9]', {\n    cwd: m\n  }, function (er, mans) {\n    if (er) return cb(er);\n    mans_(file, data, mans, cb);\n  });\n}\n\nfunction mans_(file, data, mans, cb) {\n  var m = data.directories && data.directories.man;\n  data.man = mans.map(function (mf) {\n    return path.resolve(path.dirname(file), m, mf);\n  });\n  return cb(null, data);\n}\n\nfunction bins(file, data, cb) {\n  data = normalizePackageBin(data);\n  var m = data.directories && data.directories.bin;\n  if (data.bin || !m) return cb(null, data);\n  m = path.resolve(path.dirname(file), m);\n  glob('**', {\n    cwd: m\n  }, function (er, bins) {\n    if (er) return cb(er);\n    bins_(file, data, bins, cb);\n  });\n}\n\nfunction bins_(file, data, bins, cb) {\n  var m = data.directories && data.directories.bin || '.';\n  data.bin = bins.reduce(function (acc, mf) {\n    if (mf && mf.charAt(0) !== '.') {\n      var f = path.basename(mf);\n      acc[f] = path.join(m, mf);\n    }\n\n    return acc;\n  }, {});\n  return cb(null, normalizePackageBin(data));\n}\n\nfunction bundleDependencies(file, data, cb) {\n  var bd = 'bundleDependencies';\n  var bdd = 'bundledDependencies'; // normalize key name\n\n  if (data[bdd] !== undefined) {\n    if (data[bd] === undefined) data[bd] = data[bdd];\n    delete data[bdd];\n  }\n\n  if (data[bd] === false) delete data[bd];else if (data[bd] === true) {\n    data[bd] = Object.keys(data.dependencies || {});\n  } else if (data[bd] !== undefined && !Array.isArray(data[bd])) {\n    delete data[bd];\n  }\n  return cb(null, data);\n}\n\nfunction githead(file, data, cb) {\n  if (data.gitHead) return cb(null, data);\n  var dir = path.dirname(file);\n  var head = path.resolve(dir, '.git/HEAD');\n  fs.readFile(head, 'utf8', function (er, head) {\n    if (er) return cb(null, data);\n    githead_(file, data, dir, head, cb);\n  });\n}\n\nfunction githead_(file, data, dir, head, cb) {\n  if (!head.match(/^ref: /)) {\n    data.gitHead = head.trim();\n    return cb(null, data);\n  }\n\n  var headRef = head.replace(/^ref: /, '').trim();\n  var headFile = path.resolve(dir, '.git', headRef);\n  fs.readFile(headFile, 'utf8', function (er, head) {\n    if (er || !head) {\n      var packFile = path.resolve(dir, '.git/packed-refs');\n      return fs.readFile(packFile, 'utf8', function (er, refs) {\n        if (er || !refs) {\n          return cb(null, data);\n        }\n\n        refs = refs.split('\\n');\n\n        for (var i = 0; i < refs.length; i++) {\n          var match = refs[i].match(/^([0-9a-f]{40}) (.+)$/);\n\n          if (match && match[2].trim() === headRef) {\n            data.gitHead = match[1];\n            break;\n          }\n        }\n\n        return cb(null, data);\n      });\n    }\n\n    head = head.replace(/^ref: /, '').trim();\n    data.gitHead = head;\n    return cb(null, data);\n  });\n}\n/**\n * Warn if the bin references don't point to anything.  This might be better in\n * normalize-package-data if it had access to the file path.\n */\n\n\nfunction checkBinReferences_(file, data, warn, cb) {\n  if (!(data.bin instanceof Object)) return cb();\n  var keys = Object.keys(data.bin);\n  var keysLeft = keys.length;\n  if (!keysLeft) return cb();\n\n  function handleExists(relName, result) {\n    keysLeft--;\n    if (!result) warn('No bin file found at ' + relName);\n    if (!keysLeft) cb();\n  }\n\n  keys.forEach(function (key) {\n    var dirName = path.dirname(file);\n    var relName = data.bin[key];\n    /* istanbul ignore if - impossible, bins have been normalized */\n\n    if (typeof relName !== 'string') {\n      var msg = 'Bin filename for ' + key + ' is not a string: ' + util.inspect(relName);\n      warn(msg);\n      delete data.bin[key];\n      handleExists(relName, true);\n      return;\n    }\n\n    var binPath = path.resolve(dirName, relName);\n    fs.stat(binPath, err => handleExists(relName, !err));\n  });\n}\n\nfunction final(file, data, log, strict, cb) {\n  var pId = makePackageId(data);\n\n  function warn(msg) {\n    if (typoWarned[pId]) return;\n    if (log) log('package.json', pId, msg);\n  }\n\n  try {\n    normalizeData(data, warn, strict);\n  } catch (error) {\n    return cb(error);\n  }\n\n  checkBinReferences_(file, data, warn, function () {\n    typoWarned[pId] = true;\n    cb(null, data);\n  });\n}\n\nfunction makePackageId(data) {\n  var name = cleanString(data.name);\n  var ver = cleanString(data.version);\n  return name + '@' + ver;\n}\n\nfunction cleanString(str) {\n  return !str || typeof str !== 'string' ? '' : str.trim();\n} // /**package { \"name\": \"foo\", \"version\": \"1.2.3\", ... } **/\n\n\nfunction parseIndex(data) {\n  data = data.split(/^\\/\\*\\*package(?:\\s|$)/m);\n  if (data.length < 2) return null;\n  data = data[1];\n  data = data.split(/\\*\\*\\/$/m);\n  if (data.length < 2) return null;\n  data = data[0];\n  data = data.replace(/^\\s*\\*/mg, '');\n\n  try {\n    return safeJSON(data);\n  } catch (er) {\n    return null;\n  }\n}\n\nfunction parseError(ex, file) {\n  var e = new Error('Failed to parse json\\n' + ex.message);\n  e.code = 'EJSONPARSE';\n  e.file = file;\n  return e;\n}","map":{"version":3,"sources":["/Users/kaelen/nsc-mds/node_modules/npm/node_modules/read-package-json/read-json.js"],"names":["fs","require","path","glob","normalizeData","safeJSON","util","normalizePackageBin","module","exports","readJson","extraSet","bundleDependencies","gypfile","serverjs","scriptpath","authors","readme","mans","bins","githead","typoWarned","cache","file","log_","strict_","cb_","log","strict","cb","i","arguments","length","readJson_","readFile","er","d","parseJson","stripBOM","content","charCodeAt","slice","jsonClone","obj","Array","isArray","newarr","ii","newobj","kk","code","stat","dirname","err","isDirectory","Object","create","indexjs","data","key","test","parseIndex","parseError","extrasCached","extras","basename","index","resolve","er2","set","n","errState","forEach","fn","then","final","scripts","k","keys","scriptpath_","s","spre","match","replace","dir","install","preinstall","cwd","files","gypfile_","start","serverjs_","contributors","af","ad","authors_","split","map","line","trim","filter","globOpts","nocase","mark","preferMarkdownReadme","rm","readme_","fallback","re","rmfn","readmeFilename","m","directories","man","mans_","mf","bin","bins_","reduce","acc","charAt","f","join","bd","bdd","undefined","dependencies","gitHead","head","githead_","headRef","headFile","packFile","refs","checkBinReferences_","warn","keysLeft","handleExists","relName","result","dirName","msg","inspect","binPath","pId","makePackageId","error","name","cleanString","ver","version","str","ex","e","Error","message"],"mappings":"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","sourcesContent":["var fs = require('fs')\n\nvar path = require('path')\n\nvar glob = require('glob')\nvar normalizeData = require('normalize-package-data')\nvar safeJSON = require('json-parse-even-better-errors')\nvar util = require('util')\nvar normalizePackageBin = require('npm-normalize-package-bin')\n\nmodule.exports = readJson\n\n// put more stuff on here to customize.\nreadJson.extraSet = [\n  bundleDependencies,\n  gypfile,\n  serverjs,\n  scriptpath,\n  authors,\n  readme,\n  mans,\n  bins,\n  githead\n]\n\nvar typoWarned = {}\nvar cache = {}\n\nfunction readJson (file, log_, strict_, cb_) {\n  var log, strict, cb\n  for (var i = 1; i < arguments.length - 1; i++) {\n    if (typeof arguments[i] === 'boolean') {\n      strict = arguments[i]\n    } else if (typeof arguments[i] === 'function') {\n      log = arguments[i]\n    }\n  }\n\n  if (!log) log = function () {}\n  cb = arguments[arguments.length - 1]\n\n  readJson_(file, log, strict, cb)\n}\n\nfunction readJson_ (file, log, strict, cb) {\n  fs.readFile(file, 'utf8', function (er, d) {\n    parseJson(file, er, d, log, strict, cb)\n  })\n}\n\nfunction stripBOM (content) {\n  // Remove byte order marker. This catches EF BB BF (the UTF-8 BOM)\n  // because the buffer-to-string conversion in `fs.readFileSync()`\n  // translates it to FEFF, the UTF-16 BOM.\n  if (content.charCodeAt(0) === 0xFEFF) content = content.slice(1)\n  return content\n}\n\nfunction jsonClone (obj) {\n  if (obj == null) {\n    return obj\n  } else if (Array.isArray(obj)) {\n    var newarr = new Array(obj.length)\n    for (var ii in obj) {\n      newarr[ii] = obj[ii]\n    }\n  } else if (typeof obj === 'object') {\n    var newobj = {}\n    for (var kk in obj) {\n      newobj[kk] = jsonClone[kk]\n    }\n  } else {\n    return obj\n  }\n}\n\nfunction parseJson (file, er, d, log, strict, cb) {\n  if (er && er.code === 'ENOENT') {\n    return fs.stat(path.dirname(file), function (err, stat) {\n      if (!err && stat && !stat.isDirectory()) {\n        // ENOTDIR isn't used on Windows, but npm expects it.\n        er = Object.create(er)\n        er.code = 'ENOTDIR'\n        return cb(er)\n      } else {\n        return indexjs(file, er, log, strict, cb)\n      }\n    })\n  }\n  if (er) return cb(er)\n\n  if (cache[d]) return cb(null, jsonClone(cache[d]))\n\n  var data\n\n  try {\n    data = safeJSON(stripBOM(d))\n    for (var key in data) {\n      if (/^_/.test(key)) {\n        delete data[key]\n      }\n    }\n  } catch (er) {\n    data = parseIndex(d)\n    if (!data) return cb(parseError(er, file))\n  }\n\n  extrasCached(file, d, data, log, strict, cb)\n}\n\nfunction extrasCached (file, d, data, log, strict, cb) {\n  extras(file, data, log, strict, function (err, data) {\n    if (!err) {\n      cache[d] = jsonClone(data)\n    }\n    cb(err, data)\n  })\n}\n\nfunction indexjs (file, er, log, strict, cb) {\n  if (path.basename(file) === 'index.js') return cb(er)\n\n  var index = path.resolve(path.dirname(file), 'index.js')\n  fs.readFile(index, 'utf8', function (er2, d) {\n    if (er2) return cb(er)\n\n    if (cache[d]) return cb(null, cache[d])\n\n    var data = parseIndex(d)\n    if (!data) return cb(er)\n\n    extrasCached(file, d, data, log, strict, cb)\n  })\n}\n\nreadJson.extras = extras\nfunction extras (file, data, log_, strict_, cb_) {\n  var log, strict, cb\n  for (var i = 2; i < arguments.length - 1; i++) {\n    if (typeof arguments[i] === 'boolean') {\n      strict = arguments[i]\n    } else if (typeof arguments[i] === 'function') {\n      log = arguments[i]\n    }\n  }\n\n  if (!log) log = function () {}\n  cb = arguments[i]\n\n  var set = readJson.extraSet\n  var n = set.length\n  var errState = null\n  set.forEach(function (fn) {\n    fn(file, data, then)\n  })\n\n  function then (er) {\n    if (errState) return\n    if (er) return cb(errState = er)\n    if (--n > 0) return\n    final(file, data, log, strict, cb)\n  }\n}\n\nfunction scriptpath (file, data, cb) {\n  if (!data.scripts) return cb(null, data)\n  var k = Object.keys(data.scripts)\n  k.forEach(scriptpath_, data.scripts)\n  cb(null, data)\n}\n\nfunction scriptpath_ (key) {\n  var s = this[key]\n  // This is never allowed, and only causes problems\n  if (typeof s !== 'string') return delete this[key]\n\n  var spre = /^(\\.[/\\\\])?node_modules[/\\\\].bin[\\\\/]/\n  if (s.match(spre)) {\n    this[key] = this[key].replace(spre, '')\n  }\n}\n\nfunction gypfile (file, data, cb) {\n  var dir = path.dirname(file)\n  var s = data.scripts || {}\n  if (s.install || s.preinstall) return cb(null, data)\n\n  glob('*.gyp', { cwd: dir }, function (er, files) {\n    if (er) return cb(er)\n    if (data.gypfile === false) return cb(null, data)\n    gypfile_(file, data, files, cb)\n  })\n}\n\nfunction gypfile_ (file, data, files, cb) {\n  if (!files.length) return cb(null, data)\n  var s = data.scripts || {}\n  s.install = 'node-gyp rebuild'\n  data.scripts = s\n  data.gypfile = true\n  return cb(null, data)\n}\n\nfunction serverjs (file, data, cb) {\n  var dir = path.dirname(file)\n  var s = data.scripts || {}\n  if (s.start) return cb(null, data)\n  glob('server.js', { cwd: dir }, function (er, files) {\n    if (er) return cb(er)\n    serverjs_(file, data, files, cb)\n  })\n}\n\nfunction serverjs_ (file, data, files, cb) {\n  if (!files.length) return cb(null, data)\n  var s = data.scripts || {}\n  s.start = 'node server.js'\n  data.scripts = s\n  return cb(null, data)\n}\n\nfunction authors (file, data, cb) {\n  if (data.contributors) return cb(null, data)\n  var af = path.resolve(path.dirname(file), 'AUTHORS')\n  fs.readFile(af, 'utf8', function (er, ad) {\n    // ignore error.  just checking it.\n    if (er) return cb(null, data)\n    authors_(file, data, ad, cb)\n  })\n}\n\nfunction authors_ (file, data, ad, cb) {\n  ad = ad.split(/\\r?\\n/g).map(function (line) {\n    return line.replace(/^\\s*#.*$/, '').trim()\n  }).filter(function (line) {\n    return line\n  })\n  data.contributors = ad\n  return cb(null, data)\n}\n\nfunction readme (file, data, cb) {\n  if (data.readme) return cb(null, data)\n  var dir = path.dirname(file)\n  var globOpts = { cwd: dir, nocase: true, mark: true }\n  glob('{README,README.*}', globOpts, function (er, files) {\n    if (er) return cb(er)\n    // don't accept directories.\n    files = files.filter(function (file) {\n      return !file.match(/\\/$/)\n    })\n    if (!files.length) return cb()\n    var fn = preferMarkdownReadme(files)\n    var rm = path.resolve(dir, fn)\n    readme_(file, data, rm, cb)\n  })\n}\n\nfunction preferMarkdownReadme (files) {\n  var fallback = 0\n  var re = /\\.m?a?r?k?d?o?w?n?$/i\n  for (var i = 0; i < files.length; i++) {\n    if (files[i].match(re)) {\n      return files[i]\n    } else if (files[i].match(/README$/)) {\n      fallback = i\n    }\n  }\n  // prefer README.md, followed by README; otherwise, return\n  // the first filename (which could be README)\n  return files[fallback]\n}\n\nfunction readme_ (file, data, rm, cb) {\n  var rmfn = path.basename(rm)\n  fs.readFile(rm, 'utf8', function (er, rm) {\n    // maybe not readable, or something.\n    if (er) return cb()\n    data.readme = rm\n    data.readmeFilename = rmfn\n    return cb(er, data)\n  })\n}\n\nfunction mans (file, data, cb) {\n  var m = data.directories && data.directories.man\n  if (data.man || !m) return cb(null, data)\n  m = path.resolve(path.dirname(file), m)\n  glob('**/*.[0-9]', { cwd: m }, function (er, mans) {\n    if (er) return cb(er)\n    mans_(file, data, mans, cb)\n  })\n}\n\nfunction mans_ (file, data, mans, cb) {\n  var m = data.directories && data.directories.man\n  data.man = mans.map(function (mf) {\n    return path.resolve(path.dirname(file), m, mf)\n  })\n  return cb(null, data)\n}\n\nfunction bins (file, data, cb) {\n  data = normalizePackageBin(data)\n\n  var m = data.directories && data.directories.bin\n  if (data.bin || !m) return cb(null, data)\n\n  m = path.resolve(path.dirname(file), m)\n  glob('**', { cwd: m }, function (er, bins) {\n    if (er) return cb(er)\n    bins_(file, data, bins, cb)\n  })\n}\n\nfunction bins_ (file, data, bins, cb) {\n  var m = (data.directories && data.directories.bin) || '.'\n  data.bin = bins.reduce(function (acc, mf) {\n    if (mf && mf.charAt(0) !== '.') {\n      var f = path.basename(mf)\n      acc[f] = path.join(m, mf)\n    }\n    return acc\n  }, {})\n  return cb(null, normalizePackageBin(data))\n}\n\nfunction bundleDependencies (file, data, cb) {\n  var bd = 'bundleDependencies'\n  var bdd = 'bundledDependencies'\n  // normalize key name\n  if (data[bdd] !== undefined) {\n    if (data[bd] === undefined) data[bd] = data[bdd]\n    delete data[bdd]\n  }\n  if (data[bd] === false) delete data[bd]\n  else if (data[bd] === true) {\n    data[bd] = Object.keys(data.dependencies || {})\n  } else if (data[bd] !== undefined && !Array.isArray(data[bd])) {\n    delete data[bd]\n  }\n  return cb(null, data)\n}\n\nfunction githead (file, data, cb) {\n  if (data.gitHead) return cb(null, data)\n  var dir = path.dirname(file)\n  var head = path.resolve(dir, '.git/HEAD')\n  fs.readFile(head, 'utf8', function (er, head) {\n    if (er) return cb(null, data)\n    githead_(file, data, dir, head, cb)\n  })\n}\n\nfunction githead_ (file, data, dir, head, cb) {\n  if (!head.match(/^ref: /)) {\n    data.gitHead = head.trim()\n    return cb(null, data)\n  }\n  var headRef = head.replace(/^ref: /, '').trim()\n  var headFile = path.resolve(dir, '.git', headRef)\n  fs.readFile(headFile, 'utf8', function (er, head) {\n    if (er || !head) {\n      var packFile = path.resolve(dir, '.git/packed-refs')\n      return fs.readFile(packFile, 'utf8', function (er, refs) {\n        if (er || !refs) {\n          return cb(null, data)\n        }\n        refs = refs.split('\\n')\n        for (var i = 0; i < refs.length; i++) {\n          var match = refs[i].match(/^([0-9a-f]{40}) (.+)$/)\n          if (match && match[2].trim() === headRef) {\n            data.gitHead = match[1]\n            break\n          }\n        }\n        return cb(null, data)\n      })\n    }\n    head = head.replace(/^ref: /, '').trim()\n    data.gitHead = head\n    return cb(null, data)\n  })\n}\n\n/**\n * Warn if the bin references don't point to anything.  This might be better in\n * normalize-package-data if it had access to the file path.\n */\nfunction checkBinReferences_ (file, data, warn, cb) {\n  if (!(data.bin instanceof Object)) return cb()\n\n  var keys = Object.keys(data.bin)\n  var keysLeft = keys.length\n  if (!keysLeft) return cb()\n\n  function handleExists (relName, result) {\n    keysLeft--\n    if (!result) warn('No bin file found at ' + relName)\n    if (!keysLeft) cb()\n  }\n\n  keys.forEach(function (key) {\n    var dirName = path.dirname(file)\n    var relName = data.bin[key]\n    /* istanbul ignore if - impossible, bins have been normalized */\n    if (typeof relName !== 'string') {\n      var msg = 'Bin filename for ' + key +\n        ' is not a string: ' + util.inspect(relName)\n      warn(msg)\n      delete data.bin[key]\n      handleExists(relName, true)\n      return\n    }\n    var binPath = path.resolve(dirName, relName)\n    fs.stat(binPath, (err) => handleExists(relName, !err))\n  })\n}\n\nfunction final (file, data, log, strict, cb) {\n  var pId = makePackageId(data)\n\n  function warn (msg) {\n    if (typoWarned[pId]) return\n    if (log) log('package.json', pId, msg)\n  }\n\n  try {\n    normalizeData(data, warn, strict)\n  } catch (error) {\n    return cb(error)\n  }\n\n  checkBinReferences_(file, data, warn, function () {\n    typoWarned[pId] = true\n    cb(null, data)\n  })\n}\n\nfunction makePackageId (data) {\n  var name = cleanString(data.name)\n  var ver = cleanString(data.version)\n  return name + '@' + ver\n}\n\nfunction cleanString (str) {\n  return (!str || typeof (str) !== 'string') ? '' : str.trim()\n}\n\n// /**package { \"name\": \"foo\", \"version\": \"1.2.3\", ... } **/\nfunction parseIndex (data) {\n  data = data.split(/^\\/\\*\\*package(?:\\s|$)/m)\n\n  if (data.length < 2) return null\n  data = data[1]\n  data = data.split(/\\*\\*\\/$/m)\n\n  if (data.length < 2) return null\n  data = data[0]\n  data = data.replace(/^\\s*\\*/mg, '')\n\n  try {\n    return safeJSON(data)\n  } catch (er) {\n    return null\n  }\n}\n\nfunction parseError (ex, file) {\n  var e = new Error('Failed to parse json\\n' + ex.message)\n  e.code = 'EJSONPARSE'\n  e.file = file\n  return e\n}\n"]},"metadata":{},"sourceType":"script"}