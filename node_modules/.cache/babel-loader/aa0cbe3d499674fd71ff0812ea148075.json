{"ast":null,"code":"const EOL = '\\n';\n\nconst colorizeDiff = require('@npmcli/disparity-colors');\n\nconst jsDiff = require('diff');\n\nconst shouldPrintPatch = require('./should-print-patch.js');\n\nconst formatDiff = ({\n  files,\n  opts = {},\n  refs,\n  versions\n}) => {\n  let res = '';\n  const srcPrefix = opts.diffNoPrefix ? '' : opts.diffSrcPrefix || 'a/';\n  const dstPrefix = opts.diffNoPrefix ? '' : opts.diffDstPrefix || 'b/';\n\n  for (const filename of files.values()) {\n    const names = {\n      a: `${srcPrefix}${filename}`,\n      b: `${dstPrefix}${filename}`\n    };\n    let fileMode = '';\n    const filenames = {\n      a: refs.get(`a/${filename}`),\n      b: refs.get(`b/${filename}`)\n    };\n    const contents = {\n      a: filenames.a && filenames.a.content,\n      b: filenames.b && filenames.b.content\n    };\n    const modes = {\n      a: filenames.a && filenames.a.mode,\n      b: filenames.b && filenames.b.mode\n    };\n    if (contents.a === contents.b && modes.a === modes.b) continue;\n\n    if (opts.diffNameOnly) {\n      res += `${filename}${EOL}`;\n      continue;\n    }\n\n    let patch = '';\n    let headerLength = 0;\n\n    const header = str => {\n      headerLength++;\n      patch += `${str}${EOL}`;\n    }; // manually build a git diff-compatible header\n\n\n    header(`diff --git ${names.a} ${names.b}`);\n    if (modes.a === modes.b) fileMode = filenames.a.mode;else {\n      if (modes.a && !modes.b) header(`deleted file mode ${modes.a}`);else if (!modes.a && modes.b) header(`new file mode ${modes.b}`);else {\n        header(`old mode ${modes.a}`);\n        header(`new mode ${modes.b}`);\n      }\n    }\n    header(`index ${opts.tagVersionPrefix || 'v'}${versions.a}..${opts.tagVersionPrefix || 'v'}${versions.b} ${fileMode}`);\n\n    if (shouldPrintPatch(filename)) {\n      patch += jsDiff.createTwoFilesPatch(names.a, names.b, contents.a || '', contents.b || '', '', '', {\n        context: opts.diffUnified === 0 ? 0 : opts.diffUnified || 3,\n        ignoreWhitespace: opts.diffIgnoreAllSpace\n      }).replace('===================================================================\\n', '').replace(/\\t\\n/g, '\\n'); // strip trailing tabs\n\n      headerLength += 2;\n    } else {\n      header(`--- ${names.a}`);\n      header(`+++ ${names.b}`);\n    }\n\n    res += opts.color ? colorizeDiff(patch, {\n      headerLength\n    }) : patch;\n  }\n\n  return res.trim();\n};\n\nmodule.exports = formatDiff;","map":{"version":3,"sources":["/Users/kaelen/nsc-mds/node_modules/npm/node_modules/libnpmdiff/lib/format-diff.js"],"names":["EOL","colorizeDiff","require","jsDiff","shouldPrintPatch","formatDiff","files","opts","refs","versions","res","srcPrefix","diffNoPrefix","diffSrcPrefix","dstPrefix","diffDstPrefix","filename","values","names","a","b","fileMode","filenames","get","contents","content","modes","mode","diffNameOnly","patch","headerLength","header","str","tagVersionPrefix","createTwoFilesPatch","context","diffUnified","ignoreWhitespace","diffIgnoreAllSpace","replace","color","trim","module","exports"],"mappings":"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","sourcesContent":["const EOL = '\\n'\n\nconst colorizeDiff = require('@npmcli/disparity-colors')\nconst jsDiff = require('diff')\n\nconst shouldPrintPatch = require('./should-print-patch.js')\n\nconst formatDiff = ({ files, opts = {}, refs, versions }) => {\n  let res = ''\n  const srcPrefix = opts.diffNoPrefix ? '' : opts.diffSrcPrefix || 'a/'\n  const dstPrefix = opts.diffNoPrefix ? '' : opts.diffDstPrefix || 'b/'\n\n  for (const filename of files.values()) {\n    const names = {\n      a: `${srcPrefix}${filename}`,\n      b: `${dstPrefix}${filename}`,\n    }\n\n    let fileMode = ''\n    const filenames = {\n      a: refs.get(`a/${filename}`),\n      b: refs.get(`b/${filename}`),\n    }\n    const contents = {\n      a: filenames.a && filenames.a.content,\n      b: filenames.b && filenames.b.content,\n    }\n    const modes = {\n      a: filenames.a && filenames.a.mode,\n      b: filenames.b && filenames.b.mode,\n    }\n\n    if (contents.a === contents.b && modes.a === modes.b)\n      continue\n\n    if (opts.diffNameOnly) {\n      res += `${filename}${EOL}`\n      continue\n    }\n\n    let patch = ''\n    let headerLength = 0\n    const header = str => {\n      headerLength++\n      patch += `${str}${EOL}`\n    }\n\n    // manually build a git diff-compatible header\n    header(`diff --git ${names.a} ${names.b}`)\n    if (modes.a === modes.b)\n      fileMode = filenames.a.mode\n    else {\n      if (modes.a && !modes.b)\n        header(`deleted file mode ${modes.a}`)\n      else if (!modes.a && modes.b)\n        header(`new file mode ${modes.b}`)\n      else {\n        header(`old mode ${modes.a}`)\n        header(`new mode ${modes.b}`)\n      }\n    }\n    header(`index ${opts.tagVersionPrefix || 'v'}${versions.a}..${opts.tagVersionPrefix || 'v'}${versions.b} ${fileMode}`)\n\n    if (shouldPrintPatch(filename)) {\n      patch += jsDiff.createTwoFilesPatch(\n        names.a,\n        names.b,\n        contents.a || '',\n        contents.b || '',\n        '',\n        '',\n        {\n          context: opts.diffUnified === 0 ? 0 : opts.diffUnified || 3,\n          ignoreWhitespace: opts.diffIgnoreAllSpace,\n        }\n      ).replace(\n        '===================================================================\\n',\n        ''\n      ).replace(/\\t\\n/g, '\\n') // strip trailing tabs\n      headerLength += 2\n    } else {\n      header(`--- ${names.a}`)\n      header(`+++ ${names.b}`)\n    }\n\n    res += (opts.color\n      ? colorizeDiff(patch, { headerLength })\n      : patch)\n  }\n\n  return res.trim()\n}\n\nmodule.exports = formatDiff\n"]},"metadata":{},"sourceType":"script"}