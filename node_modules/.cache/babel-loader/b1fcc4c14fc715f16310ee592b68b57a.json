{"ast":null,"code":"module.exports = init;\nmodule.exports.yes = yes;\n\nvar PZ = require('promzard').PromZard;\n\nvar path = require('path');\n\nvar def = require.resolve('./default-input.js');\n\nvar fs = require('fs');\n\nvar semver = require('semver');\n\nvar read = require('read'); // to validate the data object at the end as a worthwhile package\n// and assign default values for things.\n// readJson.extras(file, data, cb)\n\n\nvar readJson = require('read-package-json');\n\nfunction yes(conf) {\n  return !!(conf.get('yes') || conf.get('y') || conf.get('force') || conf.get('f'));\n}\n\nfunction init(dir, input, config, cb) {\n  if (typeof config === 'function') cb = config, config = {}; // accept either a plain-jane object, or a config object\n  // with a \"get\" method.\n\n  if (typeof config.get !== 'function') {\n    var data = config;\n    config = {\n      get: function (k) {\n        return data[k];\n      },\n      toJSON: function () {\n        return data;\n      }\n    };\n  }\n\n  var packageFile = path.resolve(dir, 'package.json');\n  input = path.resolve(input);\n  var pkg;\n  var ctx = {\n    yes: yes(config)\n  };\n  var es = readJson.extraSet;\n  readJson.extraSet = es.filter(function (fn) {\n    return fn.name !== 'authors' && fn.name !== 'mans';\n  });\n  readJson(packageFile, function (er, d) {\n    readJson.extraSet = es;\n    if (er) pkg = {};else pkg = d;\n    ctx.filename = packageFile;\n    ctx.dirname = path.dirname(packageFile);\n    ctx.basename = path.basename(ctx.dirname);\n    if (!pkg.version || !semver.valid(pkg.version)) delete pkg.version;\n    ctx.package = pkg;\n    ctx.config = config || {}; // make sure that the input is valid.\n    // if not, use the default\n\n    var pz = new PZ(input, ctx);\n    pz.backupFile = def;\n    pz.on('error', cb);\n    pz.on('data', function (data) {\n      Object.keys(data).forEach(function (k) {\n        if (data[k] !== undefined && data[k] !== null) pkg[k] = data[k];\n      }); // only do a few of these.\n      // no need for mans or contributors if they're in the files\n\n      var es = readJson.extraSet;\n      readJson.extraSet = es.filter(function (fn) {\n        return fn.name !== 'authors' && fn.name !== 'mans';\n      });\n      readJson.extras(packageFile, pkg, function (er, pkg) {\n        readJson.extraSet = es;\n        if (er) return cb(er, pkg);\n        pkg = unParsePeople(pkg); // no need for the readme now.\n\n        delete pkg.readme;\n        delete pkg.readmeFilename; // really don't want to have this lying around in the file\n\n        delete pkg._id; // ditto\n\n        delete pkg.gitHead; // if the repo is empty, remove it.\n\n        if (!pkg.repository) delete pkg.repository; // readJson filters out empty descriptions, but init-package-json\n        // traditionally leaves them alone\n\n        if (!pkg.description) pkg.description = data.description;\n        var d = JSON.stringify(updateDeps(pkg), null, 2) + '\\n';\n\n        function write(yes) {\n          fs.writeFile(packageFile, d, 'utf8', function (er) {\n            if (!er && yes && !config.get('silent')) {\n              console.log('Wrote to %s:\\n\\n%s\\n', packageFile, d);\n            }\n\n            return cb(er, pkg);\n          });\n        }\n\n        if (ctx.yes) {\n          return write(true);\n        }\n\n        console.log('About to write to %s:\\n\\n%s\\n', packageFile, d);\n        read({\n          prompt: 'Is this OK? ',\n          default: 'yes'\n        }, function (er, ok) {\n          if (er) {\n            return cb(er);\n          }\n\n          if (!ok || ok.toLowerCase().charAt(0) !== 'y') {\n            console.log('Aborted.');\n          } else {\n            return write();\n          }\n        });\n      });\n    });\n  });\n}\n\nfunction updateDeps(depsData) {\n  // optionalDependencies don't need to be repeated in two places\n  if (depsData.dependencies) {\n    if (depsData.optionalDependencies) {\n      for (const name of Object.keys(depsData.optionalDependencies)) delete depsData.dependencies[name];\n    }\n\n    if (Object.keys(depsData.dependencies).length === 0) delete depsData.dependencies;\n  }\n\n  return depsData;\n} // turn the objects into somewhat more humane strings.\n\n\nfunction unParsePeople(data) {\n  if (data.author) data.author = unParsePerson(data.author);\n  [\"maintainers\", \"contributors\"].forEach(function (set) {\n    if (!Array.isArray(data[set])) return;\n    data[set] = data[set].map(unParsePerson);\n  });\n  return data;\n}\n\nfunction unParsePerson(person) {\n  if (typeof person === \"string\") return person;\n  var name = person.name || \"\";\n  var u = person.url || person.web;\n  var url = u ? \" (\" + u + \")\" : \"\";\n  var e = person.email || person.mail;\n  var email = e ? \" <\" + e + \">\" : \"\";\n  return name + email + url;\n}","map":{"version":3,"sources":["/Users/kaelen/nsc-mds/node_modules/npm/node_modules/init-package-json/init-package-json.js"],"names":["module","exports","init","yes","PZ","require","PromZard","path","def","resolve","fs","semver","read","readJson","conf","get","dir","input","config","cb","data","k","toJSON","packageFile","pkg","ctx","es","extraSet","filter","fn","name","er","d","filename","dirname","basename","version","valid","package","pz","backupFile","on","Object","keys","forEach","undefined","extras","unParsePeople","readme","readmeFilename","_id","gitHead","repository","description","JSON","stringify","updateDeps","write","writeFile","console","log","prompt","default","ok","toLowerCase","charAt","depsData","dependencies","optionalDependencies","length","author","unParsePerson","set","Array","isArray","map","person","u","url","web","e","email","mail"],"mappings":"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","sourcesContent":["\nmodule.exports = init\nmodule.exports.yes = yes\n\nvar PZ = require('promzard').PromZard\nvar path = require('path')\nvar def = require.resolve('./default-input.js')\n\nvar fs = require('fs')\nvar semver = require('semver')\nvar read = require('read')\n\n// to validate the data object at the end as a worthwhile package\n// and assign default values for things.\n// readJson.extras(file, data, cb)\nvar readJson = require('read-package-json')\n\nfunction yes (conf) {\n  return !!(\n    conf.get('yes') || conf.get('y') ||\n    conf.get('force') || conf.get('f')\n  )\n}\n\nfunction init (dir, input, config, cb) {\n  if (typeof config === 'function')\n    cb = config, config = {}\n\n  // accept either a plain-jane object, or a config object\n  // with a \"get\" method.\n  if (typeof config.get !== 'function') {\n    var data = config\n    config = {\n      get: function (k) {\n        return data[k]\n      },\n      toJSON: function () {\n        return data\n      }\n    }\n  }\n\n  var packageFile = path.resolve(dir, 'package.json')\n  input = path.resolve(input)\n  var pkg\n  var ctx = { yes: yes(config) }\n\n  var es = readJson.extraSet\n  readJson.extraSet = es.filter(function (fn) {\n    return fn.name !== 'authors' && fn.name !== 'mans'\n  })\n  readJson(packageFile, function (er, d) {\n    readJson.extraSet = es\n\n    if (er) pkg = {}\n    else pkg = d\n\n    ctx.filename = packageFile\n    ctx.dirname = path.dirname(packageFile)\n    ctx.basename = path.basename(ctx.dirname)\n    if (!pkg.version || !semver.valid(pkg.version))\n      delete pkg.version\n\n    ctx.package = pkg\n    ctx.config = config || {}\n\n    // make sure that the input is valid.\n    // if not, use the default\n    var pz = new PZ(input, ctx)\n    pz.backupFile = def\n    pz.on('error', cb)\n    pz.on('data', function (data) {\n      Object.keys(data).forEach(function (k) {\n        if (data[k] !== undefined && data[k] !== null) pkg[k] = data[k]\n      })\n\n      // only do a few of these.\n      // no need for mans or contributors if they're in the files\n      var es = readJson.extraSet\n      readJson.extraSet = es.filter(function (fn) {\n        return fn.name !== 'authors' && fn.name !== 'mans'\n      })\n      readJson.extras(packageFile, pkg, function (er, pkg) {\n        readJson.extraSet = es\n        if (er) return cb(er, pkg)\n        pkg = unParsePeople(pkg)\n        // no need for the readme now.\n        delete pkg.readme\n        delete pkg.readmeFilename\n\n        // really don't want to have this lying around in the file\n        delete pkg._id\n\n        // ditto\n        delete pkg.gitHead\n\n        // if the repo is empty, remove it.\n        if (!pkg.repository)\n          delete pkg.repository\n\n        // readJson filters out empty descriptions, but init-package-json\n        // traditionally leaves them alone\n        if (!pkg.description)\n          pkg.description = data.description\n\n        var d = JSON.stringify(updateDeps(pkg), null, 2) + '\\n'\n        function write (yes) {\n          fs.writeFile(packageFile, d, 'utf8', function (er) {\n            if (!er && yes && !config.get('silent')) {\n              console.log('Wrote to %s:\\n\\n%s\\n', packageFile, d)\n            }\n            return cb(er, pkg)\n          })\n        }\n        if (ctx.yes) {\n          return write(true)\n        }\n        console.log('About to write to %s:\\n\\n%s\\n', packageFile, d)\n        read({prompt:'Is this OK? ', default: 'yes'}, function (er, ok) {\n          if (er) {\n            return cb(er)\n          }\n          if (!ok || ok.toLowerCase().charAt(0) !== 'y') {\n            console.log('Aborted.')\n          } else {\n            return write()\n          }\n        })\n      })\n    })\n  })\n\n}\n\nfunction updateDeps(depsData) {\n  // optionalDependencies don't need to be repeated in two places\n  if (depsData.dependencies) {\n    if (depsData.optionalDependencies) {\n      for (const name of Object.keys(depsData.optionalDependencies))\n        delete depsData.dependencies[name]\n    }\n    if (Object.keys(depsData.dependencies).length === 0)\n      delete depsData.dependencies\n  }\n\n  return depsData\n}\n\n// turn the objects into somewhat more humane strings.\nfunction unParsePeople (data) {\n  if (data.author) data.author = unParsePerson(data.author)\n  ;[\"maintainers\", \"contributors\"].forEach(function (set) {\n    if (!Array.isArray(data[set])) return;\n    data[set] = data[set].map(unParsePerson)\n  })\n  return data\n}\n\nfunction unParsePerson (person) {\n  if (typeof person === \"string\") return person\n  var name = person.name || \"\"\n  var u = person.url || person.web\n  var url = u ? (\" (\"+u+\")\") : \"\"\n  var e = person.email || person.mail\n  var email = e ? (\" <\"+e+\">\") : \"\"\n  return name+email+url\n}\n\n"]},"metadata":{},"sourceType":"script"}