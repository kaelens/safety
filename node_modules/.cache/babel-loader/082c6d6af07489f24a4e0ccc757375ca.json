{"ast":null,"code":"var fs = require('graceful-fs');\n\nvar dz = require('dezalgo');\n\nvar once = require('once');\n\nvar path = require('path');\n\nvar debug = require('debuglog')('rds');\n\nmodule.exports = readdir;\nreaddir.sync = readdirSync;\n\nfunction readdir(dir, cb) {\n  fs.readdir(dir, function (er, kids) {\n    if (er) return cb(er);\n    debug('dir=%j, kids=%j', dir, kids);\n    readScopes(dir, kids, function (er, data) {\n      if (er) return cb(er); // Sort for bonus consistency points\n\n      data = data.sort(function (a, b) {\n        return a > b ? 1 : -1;\n      });\n      return cb(null, data);\n    });\n  });\n}\n\nfunction readdirSync(dir) {\n  var kids = fs.readdirSync(dir);\n  debug('dir=%j, kids=%j', dir, kids);\n  var data = readScopesSync(dir, kids); // Sort for bonus consistency points\n\n  data = data.sort(function (a, b) {\n    return a > b ? 1 : -1;\n  });\n  return data;\n} // Turn [ 'a', '@scope' ] into\n// ['a', '@scope/foo', '@scope/bar']\n\n\nfunction readScopes(root, kids, cb) {\n  var scopes = kids.filter(function (kid) {\n    return kid.charAt(0) === '@';\n  });\n  kids = kids.filter(function (kid) {\n    return kid.charAt(0) !== '@';\n  });\n  debug('scopes=%j', scopes);\n  if (scopes.length === 0) dz(cb)(null, kids); // prevent maybe-sync zalgo release\n\n  cb = once(cb);\n  var l = scopes.length;\n  scopes.forEach(function (scope) {\n    var scopedir = path.resolve(root, scope);\n    debug('root=%j scope=%j scopedir=%j', root, scope, scopedir);\n    fs.readdir(scopedir, then.bind(null, scope));\n  });\n\n  function then(scope, er, scopekids) {\n    if (er) return cb(er); // XXX: Not sure how old this node bug is. Maybe superstition?\n\n    scopekids = scopekids.filter(function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid);\n    });\n    kids.push.apply(kids, scopekids.map(function (scopekid) {\n      return scope + '/' + scopekid;\n    }));\n    debug('scope=%j scopekids=%j kids=%j', scope, scopekids, kids);\n    if (--l === 0) cb(null, kids);\n  }\n}\n\nfunction readScopesSync(root, kids) {\n  var scopes = kids.filter(function (kid) {\n    return kid.charAt(0) === '@';\n  });\n  kids = kids.filter(function (kid) {\n    return kid.charAt(0) !== '@';\n  });\n  debug('scopes=%j', scopes);\n  if (scopes.length === 0) return kids;\n  var l = scopes.length;\n  scopes.forEach(function (scope) {\n    var scopedir = path.resolve(root, scope);\n    debug('root=%j scope=%j scopedir=%j', root, scope, scopedir);\n    then(scope, fs.readdirSync(scopedir));\n  });\n\n  function then(scope, scopekids) {\n    // XXX: Not sure how old this node bug is. Maybe superstition?\n    scopekids = scopekids.filter(function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid);\n    });\n    kids.push.apply(kids, scopekids.map(function (scopekid) {\n      return scope + '/' + scopekid;\n    }));\n    debug('scope=%j scopekids=%j kids=%j', scope, scopekids, kids);\n  }\n\n  return kids;\n}","map":{"version":3,"sources":["/Users/kaelen/nsc-mds/node_modules/npm/node_modules/readdir-scoped-modules/readdir.js"],"names":["fs","require","dz","once","path","debug","module","exports","readdir","sync","readdirSync","dir","cb","er","kids","readScopes","data","sort","a","b","readScopesSync","root","scopes","filter","kid","charAt","length","l","forEach","scope","scopedir","resolve","then","bind","scopekids","scopekid","push","apply","map"],"mappings":"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","sourcesContent":["var fs = require ('graceful-fs')\nvar dz = require ('dezalgo')\nvar once = require ('once')\nvar path = require ('path')\nvar debug = require ('debuglog') ('rds')\n\nmodule . exports = readdir\nreaddir.sync = readdirSync\n\nfunction readdir (dir, cb) {\n  fs . readdir (dir, function (er, kids) {\n    if (er)\n      return cb (er)\n\n    debug ('dir=%j, kids=%j', dir, kids)\n    readScopes (dir, kids, function (er, data) {\n      if (er)\n        return cb (er)\n\n      // Sort for bonus consistency points\n      data = data . sort (function (a, b) {\n        return a > b ? 1 : -1\n      })\n\n      return cb (null, data)\n    })\n  })\n}\n\nfunction readdirSync (dir) {\n  var kids = fs . readdirSync (dir)\n  debug ('dir=%j, kids=%j', dir, kids)\n  var data =  readScopesSync (dir, kids)\n  // Sort for bonus consistency points\n  data = data . sort (function (a, b) {\n    return a > b ? 1 : -1\n  })\n\n  return data\n}\n\n// Turn [ 'a', '@scope' ] into\n// ['a', '@scope/foo', '@scope/bar']\nfunction readScopes (root, kids, cb) {\n  var scopes = kids . filter (function (kid) {\n    return kid . charAt (0) === '@'\n  })\n\n  kids = kids . filter (function (kid) {\n    return kid . charAt (0) !== '@'\n  })\n\n  debug ('scopes=%j', scopes)\n\n  if (scopes . length === 0)\n    dz (cb) (null, kids) // prevent maybe-sync zalgo release\n\n  cb = once (cb)\n  var l = scopes . length\n  scopes . forEach (function (scope) {\n    var scopedir = path . resolve (root, scope)\n    debug ('root=%j scope=%j scopedir=%j', root, scope, scopedir)\n    fs . readdir (scopedir, then . bind (null, scope))\n  })\n\n  function then (scope, er, scopekids) {\n    if (er)\n      return cb (er)\n\n    // XXX: Not sure how old this node bug is. Maybe superstition?\n    scopekids = scopekids . filter (function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid)\n    })\n\n    kids . push . apply (kids, scopekids . map (function (scopekid) {\n      return scope + '/' + scopekid\n    }))\n\n    debug ('scope=%j scopekids=%j kids=%j', scope, scopekids, kids)\n\n    if (--l === 0)\n      cb (null, kids)\n  }\n}\n\nfunction readScopesSync (root, kids) {\n  var scopes = kids . filter (function (kid) {\n    return kid . charAt (0) === '@'\n  })\n\n  kids = kids . filter (function (kid) {\n    return kid . charAt (0) !== '@'\n  })\n\n  debug ('scopes=%j', scopes)\n\n  if (scopes . length === 0)\n    return kids\n\n  var l = scopes . length\n  scopes . forEach (function (scope) {\n    var scopedir = path . resolve (root, scope)\n    debug ('root=%j scope=%j scopedir=%j', root, scope, scopedir)\n    then (scope, fs . readdirSync (scopedir))\n  })\n\n  function then (scope, scopekids) {\n    // XXX: Not sure how old this node bug is. Maybe superstition?\n    scopekids = scopekids . filter (function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid)\n    })\n\n    kids . push . apply (kids, scopekids . map (function (scopekid) {\n      return scope + '/' + scopekid\n    }))\n\n    debug ('scope=%j scopekids=%j kids=%j', scope, scopekids, kids)\n  }\n\n  return kids\n}\n"]},"metadata":{},"sourceType":"script"}